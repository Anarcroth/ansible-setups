---
- hosts: all
  become: yes

  vars_files:
    - vars/postgresql.yml
  pre_tasks:
    - name: Update apt's cache
      apt: update_cache=yes cache_valid_time=3600

  tasks:
    - name: Ensure PostgreSQL and important dependencies are present
      apt: name={{item}} state=present
      with_items:
      - postgresql
      - python-psycopg2

    - name: Create a new PostgreSQL superuser
      postgresql_user: name={{user}} password={{pass}}
        role_attr_flags=SUPERUSER
        state=present
      become: yes
      become_user: postgres
